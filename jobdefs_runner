#!/bin/bash

# Simple shell wrapper for jobdefs_runner.py
# Sets up Mu2e environment and calls the Python script

set -e  # Exit on any error

# Check required arguments
if [[ $# -eq 0 ]] || [[ "$1" == "--help" ]] || [[ "$1" == "-h" ]]; then
    echo "Usage: $0 [options] --jobdefs <jobdefs_file>"
    echo "  --jobdefs   Path to job definitions file (required)"
    echo "  --copy-input        Copy input files using mdh"
    echo "  --dry-run          Print commands without actually running pushOutput"
    echo "  --nevts <n>        Number of events to process (-1 for all events)"
    exit 1
fi

# Source Mu2e environment
echo "Setting up Mu2e environment..."
source /cvmfs/mu2e.opensciencegrid.org/setupmu2e-art.sh
muse setup ops

# Find and execute the Python script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PYTHON_SCRIPT="$SCRIPT_DIR/jobdefs_runner.py"

if [[ ! -f "$PYTHON_SCRIPT" ]]; then
    echo "Error: Python script not found at $PYTHON_SCRIPT"
    exit 1
fi

# Execute the Python script with all arguments
exec python3 "$PYTHON_SCRIPT" "$@"
