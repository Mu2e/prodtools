[stage_main_digi]

global.fcl = "Production/JobConfig/digitize/OnSpill.fcl"
global.dbversion = v1_3

job_setup.prescript_1 = echo '#include "%(fcl)s"' > template.fcl
job_setup.prescript_2 = echo 'services.DbService.purpose: "MDC2020_{dbpurpose}"' >> template.fcl
job_setup.prescript_3 = echo 'services.DbService.version: "{dbversion}"' >> template.fcl
job_setup.prescript_4 = echo 'services.DbService.verbose: 2' >> template.fcl
job_setup.prescript_5 = echo 'services.SeedService.baseSeed: "{seed}"' >> template.fcl
job_setup.prescript_6 = echo 'outputs.TriggeredOutput.fileName:   "dig.mu2e.{desc}OnSpillTriggered.MDC2020{release}_{dbpurpose}_{dbversion}.{sequence}.art"' >> template.fcl
job_setup.prescript_7 = echo 'outputs.TriggerableOutput.fileName: "dig.mu2e.{desc}OnSpillTriggerable.MDC2020{release}_{dbpurpose}_{dbversion}.{sequence}.art"' >> template.fcl

executable_1.name = runfcl
executable_1.arg_1 = --fcl template.fcl
executable_1.arg_2 = --release %(release_v_o)s
executable_1.arg_3 = --dbpurpose perfect
executable_1.arg_4 = --dbversion %(dbversion)s
executable_1.arg_5 = --outloc %(outloc)s
executable_1.arg_6 = --simjob_setup %(simjob_setup)s

executable_2.name = runfcl
executable_2.arg_1 = --fcl template.fcl
executable_2.arg_2 = --release %(release_v_o)s
executable_2.arg_3 = --dbpurpose best
executable_2.arg_4 = --dbversion %(dbversion)s
executable_2.arg_5 = --outloc %(outloc)s
executable_2.arg_6 = --simjob_setup %(simjob_setup)s

submit.n_files_per_job = 1
job_setup.multifile = True

[stage_main_reco]

global.fcl = "Production/JobConfig/reco/OnSpill.fcl"

job_setup.prescript_1 = echo '#include "%(fcl)s"' > template.fcl
job_setup.prescript_2 = echo 'services.DbService.purpose: "MDC2020_{dbpurpose}"' >> template.fcl
job_setup.prescript_3 = echo 'services.DbService.version: "{dbversion}"' >> template.fcl
job_setup.prescript_4 = echo 'services.DbService.verbose: 2' >> template.fcl
job_setup.prescript_5 = echo 'outputs.LoopHelixOutput.fileName: "mcs.mu2e.{desc}.{dsconf}.{sequence}.art"' >> template.fcl

executable_1.name = runfcl
executable_1.arg_1 = --fcl template.fcl
executable_1.arg_2 = --release %(release_v_o)s
executable_1.arg_3 = --outloc %(outloc)s
executable_1.arg_4 = --simjob_setup %(simjob_setup)s

submit.n_files_per_job = 1
submit.disk = 80GB
job_setup.multifile = True

[stage_main_evntuple]

global.fcl = "EventNtuple/fcl/from_mcs-mockdata.fcl"

job_setup.prescript_1 = echo '#include "%(fcl)s"' > template.fcl
job_setup.prescript_2 = echo 'services.TFileService.fileName: "nts.mu2e.{desc}.{dsconf}_%(ntuple)s.{sequence}.root"' >> template.fcl

executable_1.name = runfcl
executable_1.arg_1 = --fcl template.fcl
executable_1.arg_2 = --setup /cvmfs/mu2e.opensciencegrid.org/Musings/EventNtuple/%(ntuple)s/setup.sh
executable_1.arg_3 = --outloc %(outloc)s
executable_1.arg_4 = --simjob_setup %(simjob_setup)s

submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True


[stage_main_runjobdef]

global.nevts = -1

submit.f=dropbox:///exp/mu2e/app/users/mu2epro/production_manager/poms_map/%(map)s

executable_1.name = runjobdef
executable_1.arg_1 = --jobdefs \\\\\\\$CONDOR_DIR_INPUT/%(map)s
executable_1.arg_2 = --nevts %(nevts)s
submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True


[stage_main_validation]

global.fcl = "Production/Validation/nightly/MDS/digitize.fcl"

global.simjob_setup=$(ls -t /cvmfs/mu2e-development.opensciencegrid.org/museCIBuild/main/*/setup.sh | head -1)
submit.f_4=dropbox:///exp/mu2e/app/users/oksuzian/local_validation/test_single_job.sh
job_setup.prescript_1 = echo '#include "%(fcl)s"' > template.fcl

executable_1.name = \\\\\\\$CONDOR_DIR_INPUT/test_single_job.sh
executable_1.arg_1 = --fcl template.fcl

submit.n_files_per_job = 1
sam_consumer.limit = 1
job_setup.multifile = True
